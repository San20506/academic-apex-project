{% extends "base.html" %}

{% block title %}Dashboard - Academic Apex Strategist{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="hero gradient-bg rounded-lg text-white">
        <div class="hero-content text-center py-12">
            <div class="max-w-md">
                <h1 class="mb-5 text-4xl font-bold">
                    <i class="fas fa-graduation-cap mr-3"></i>
                    Welcome to Academic Apex
                </h1>
                <p class="mb-5 text-lg opacity-90">
                    Your AI-powered academic assistant for creating study plans, quizzes, and educational content using local models.
                </p>
                <div class="flex justify-center gap-2">
                    <div class="badge badge-outline badge-lg">ðŸ¤– Local AI</div>
                    <div class="badge badge-outline badge-lg">ðŸ”’ Privacy-First</div>
                    <div class="badge badge-outline badge-lg">ðŸ“š Educational</div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Status Overview -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="stat bg-base-200 rounded-lg">
            <div class="stat-figure text-primary">
                <i class="fas fa-robot text-2xl"></i>
            </div>
            <div class="stat-title">Ollama Status</div>
            <div class="stat-value text-lg" id="ollama-status">
                {% if status.ollama_connected %}
                    <span class="text-success">Connected</span>
                {% else %}
                    <span class="text-error">Disconnected</span>
                {% endif %}
            </div>
            <div class="stat-desc" id="models-count">
                {{ status.models_available|length }} models available
            </div>
        </div>

        <div class="stat bg-base-200 rounded-lg">
            <div class="stat-figure text-secondary">
                <i class="fas fa-cogs text-2xl"></i>
            </div>
            <div class="stat-title">Curator Service</div>
            <div class="stat-value text-lg" id="curator-status">
                {% if status.curator_running %}
                    <span class="text-success">Running</span>
                {% else %}
                    <span class="text-error">Offline</span>
                {% endif %}
            </div>
            <div class="stat-desc">Prompt optimization</div>
        </div>

        <div class="stat bg-base-200 rounded-lg">
            <div class="stat-figure text-accent">
                <i class="fas fa-folder text-2xl"></i>
            </div>
            <div class="stat-title">Obsidian Vault</div>
            <div class="stat-value text-lg" id="vault-status">
                {% if vault_configured %}
                    <span class="text-success">Ready</span>
                {% else %}
                    <span class="text-warning">Not Set</span>
                {% endif %}
            </div>
            <div class="stat-desc">
                {% if vault_configured %}
                    Notes saved automatically
                {% else %}
                    Configure in settings
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-6">
                <i class="fas fa-bolt text-primary"></i>
                Quick Actions
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Generate Quiz -->
                <div class="card bg-base-100 shadow-md card-hover">
                    <div class="card-body text-center">
                        <div class="text-4xl text-primary mb-3">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <h3 class="card-title justify-center">Generate Quiz</h3>
                        <p class="text-sm opacity-70 mb-4">
                            Create comprehensive diagnostic quizzes for any subject with customizable difficulty levels.
                        </p>
                        <div class="card-actions justify-center">
                            <a href="{{ url_for('generate_quiz') }}" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                Create Quiz
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Study Plan -->
                <div class="card bg-base-100 shadow-md card-hover">
                    <div class="card-body text-center">
                        <div class="text-4xl text-secondary mb-3">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <h3 class="card-title justify-center">Study Plan</h3>
                        <p class="text-sm opacity-70 mb-4">
                            Generate detailed, minute-by-minute study plans with active learning techniques.
                        </p>
                        <div class="card-actions justify-center">
                            <a href="{{ url_for('generate_study_plan') }}" class="btn btn-secondary">
                                <i class="fas fa-plus"></i>
                                Create Plan
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Generate Code -->
                <div class="card bg-base-100 shadow-md card-hover">
                    <div class="card-body text-center">
                        <div class="text-4xl text-accent mb-3">
                            <i class="fas fa-code"></i>
                        </div>
                        <h3 class="card-title justify-center">Generate Code</h3>
                        <p class="text-sm opacity-70 mb-4">
                            Create Python modules and utilities for academic and educational tasks.
                        </p>
                        <div class="card-actions justify-center">
                            <a href="{{ url_for('generate_code') }}" class="btn btn-accent">
                                <i class="fas fa-plus"></i>
                                Write Code
                            </a>
                        </div>
                    </div>
                </div>

                <!-- My Files -->
                <div class="card bg-base-100 shadow-md card-hover">
                    <div class="card-body text-center">
                        <div class="text-4xl text-info mb-3">
                            <i class="fas fa-folder-open"></i>
                        </div>
                        <h3 class="card-title justify-center">My Files</h3>
                        <p class="text-sm opacity-70 mb-4">
                            View, download, and manage all your generated educational content.
                        </p>
                        <div class="card-actions justify-center">
                            <a href="{{ url_for('list_files') }}" class="btn btn-info">
                                <i class="fas fa-eye"></i>
                                View Files
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Settings -->
                <div class="card bg-base-100 shadow-md card-hover">
                    <div class="card-body text-center">
                        <div class="text-4xl text-warning mb-3">
                            <i class="fas fa-cog"></i>
                        </div>
                        <h3 class="card-title justify-center">Settings</h3>
                        <p class="text-sm opacity-70 mb-4">
                            Configure Obsidian vault, models, and system preferences.
                        </p>
                        <div class="card-actions justify-center">
                            <a href="{{ url_for('settings') }}" class="btn btn-warning">
                                <i class="fas fa-edit"></i>
                                Configure
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Help & Docs -->
                <div class="card bg-base-100 shadow-md card-hover">
                    <div class="card-body text-center">
                        <div class="text-4xl text-neutral mb-3">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <h3 class="card-title justify-center">Help & Docs</h3>
                        <p class="text-sm opacity-70 mb-4">
                            Learn how to get the most out of Academic Apex Strategist.
                        </p>
                        <div class="card-actions justify-center">
                            <button onclick="showHelpModal()" class="btn btn-neutral">
                                <i class="fas fa-book"></i>
                                Learn More
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity (if files exist) -->
    <div class="card bg-base-200 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-xl mb-4">
                <i class="fas fa-history text-primary"></i>
                Recent Activity
            </h2>
            
            <div id="recent-activity" class="space-y-3">
                <!-- This will be populated by JavaScript -->
                <div class="text-center py-8 opacity-60">
                    <i class="fas fa-clock text-4xl mb-3"></i>
                    <p>No recent activity. Start by generating your first educational content!</p>
                </div>
            </div>
            
            <div class="text-center mt-4">
                <a href="{{ url_for('list_files') }}" class="btn btn-ghost btn-sm">
                    View All Files <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Issues/Warnings (if any) -->
    {% if status.issues %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle"></i>
        <div>
            <h3 class="font-bold">System Issues Detected</h3>
            <div class="text-sm mt-2">
                {% for issue in status.issues[:3] %}
                    <div>â€¢ {{ issue }}</div>
                {% endfor %}
                {% if status.issues|length > 3 %}
                    <div class="mt-1 opacity-70">... and {{ status.issues|length - 3 }} more</div>
                {% endif %}
            </div>
        </div>
        <div>
            <button onclick="showTroubleshootingModal()" class="btn btn-sm">
                Troubleshoot
            </button>
        </div>
    </div>
    {% endif %}
</div>

<!-- Help Modal -->
<dialog id="help_modal" class="modal">
    <div class="modal-box w-11/12 max-w-3xl">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
        </form>
        
        <h3 class="font-bold text-lg mb-4">
            <i class="fas fa-graduation-cap text-primary"></i>
            Getting Started with Academic Apex
        </h3>
        
        <div class="space-y-4">
            <div class="collapse collapse-arrow bg-base-200">
                <input type="radio" name="help-accordion" checked="checked" /> 
                <div class="collapse-title text-lg font-medium">
                    ðŸš€ Quick Start Guide
                </div>
                <div class="collapse-content"> 
                    <ol class="list-decimal list-inside space-y-2 text-sm">
                        <li>Ensure Ollama is running with deepseek-coder model</li>
                        <li>Start the curator service (optional for better prompts)</li>
                        <li>Set your Obsidian vault path in Settings (optional)</li>
                        <li>Choose a generation type and start creating!</li>
                    </ol>
                </div>
            </div>
            
            <div class="collapse collapse-arrow bg-base-200">
                <input type="radio" name="help-accordion" /> 
                <div class="collapse-title text-lg font-medium">
                    ðŸŽ¯ Best Practices
                </div>
                <div class="collapse-content">
                    <ul class="list-disc list-inside space-y-2 text-sm">
                        <li>Be specific about your subject and learning objectives</li>
                        <li>Use appropriate difficulty levels for your audience</li>
                        <li>Enable prompt curation for better results</li>
                        <li>Review generated content before using with students</li>
                    </ul>
                </div>
            </div>
            
            <div class="collapse collapse-arrow bg-base-200">
                <input type="radio" name="help-accordion" /> 
                <div class="collapse-title text-lg font-medium">
                    ðŸ”§ Troubleshooting
                </div>
                <div class="collapse-content">
                    <ul class="list-disc list-inside space-y-2 text-sm">
                        <li><strong>Ollama disconnected:</strong> Ensure Ollama is running on port 11434</li>
                        <li><strong>Curator offline:</strong> Start curator_service.py manually</li>
                        <li><strong>Slow generation:</strong> Consider using smaller models or reducing max_tokens</li>
                        <li><strong>Vault issues:</strong> Check OBSIDIAN_VAULT_PATH environment variable</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</dialog>

<!-- Troubleshooting Modal -->
<dialog id="troubleshooting_modal" class="modal">
    <div class="modal-box">
        <form method="dialog">
            <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
        </form>
        
        <h3 class="font-bold text-lg mb-4">ðŸ”§ System Troubleshooting</h3>
        
        <div class="space-y-4">
            {% for issue in status.issues %}
            <div class="alert alert-warning alert-sm">
                <i class="fas fa-exclamation-triangle"></i>
                <span class="text-sm">{{ issue }}</span>
            </div>
            {% endfor %}
            
            <div class="text-sm space-y-2 mt-4">
                <h4 class="font-semibold">Quick Fixes:</h4>
                <ul class="list-disc list-inside space-y-1">
                    <li>Restart Ollama service: <code class="bg-base-300 px-1 rounded">ollama serve</code></li>
                    <li>Start curator: <code class="bg-base-300 px-1 rounded">python curator_service.py</code></li>
                    <li>Check system status in navigation bar</li>
                </ul>
            </div>
        </div>
        
        <div class="modal-action">
            <button onclick="updateSystemStatus()" class="btn btn-primary btn-sm">
                <i class="fas fa-refresh"></i>
                Recheck Status
            </button>
        </div>
    </div>
</dialog>
{% endblock %}

{% block scripts %}
<script>
function showHelpModal() {
    document.getElementById('help_modal').showModal();
}

function showTroubleshootingModal() {
    document.getElementById('troubleshooting_modal').showModal();
}

// Load recent activity
async function loadRecentActivity() {
    try {
        const response = await fetch('/files');
        // This would need to be an API endpoint that returns JSON
        // For now, we'll just show a placeholder
    } catch (error) {
        console.error('Failed to load recent activity:', error);
    }
}

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    // loadRecentActivity();
    
    // Refresh status every 30 seconds
    setInterval(updateSystemStatus, 30000);
});
</script>
{% endblock %}
